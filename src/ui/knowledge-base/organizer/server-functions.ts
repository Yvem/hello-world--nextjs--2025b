'use server';

import { getOpenAIClient } from '@/lib/server/generic/openai-api-client';

import { extractStructure as _extractStructure, type ExtractedStructure, filterAndImproveSection as _filterAndImproveSection, type FilterAndImproveSectionInput, type ImprovedKnowledgeBaseSection } from '@/lib/isomorphic/business/knowledge-base/organizer/ai';

/////////////////////////////////////////////////

const ES_API_RESPONSE_1 = undefined; // JSON.parse(`{"id":"resp_68495fda240881a2bc5c7a3c0d9603fd0175cb3e964d3785","object":"response","created_at":1749639130,"status":"completed","background":false,"error":null,"incomplete_details":null,"instructions":null,"max_output_tokens":null,"model":"gpt-4o-mini-2024-07-18","output":[{"id":"msg_68495fda941881a28f0fd26ea1a816900175cb3e964d3785","type":"message","status":"completed","content":[{"type":"output_text","annotations":[],"text":"~#BEGIN#~\\nOur new employee onboarding process starts the first Monday of every month, beginning with a mandatory virtual orientation session from 9 AM to 12 PM AEST. New hires will receive an email with their login credentials for the HR portal and our internal collaboration tool, Slack, 48 hours prior to their start date. It's crucial that they complete their tax forms and set up direct deposit in the HR portal within the first three days. After orientation, each new hire will be introduced to their team lead, who will guide them through specific departmental training and project assignments. We also offer a mentorship program where new employees are paired with experienced colleagues for the first six months to help them settle in and understand our company culture. Benefits enrollment, including health insurance and 401(k), must be completed by the end of their first week. For IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555. They will be provisioned with a laptop and necessary software by the end of their first day, provided they have completed the pre-onboarding IT survey.\\n~#END#~"}],"role":"assistant"}],"parallel_tool_calls":true,"previous_response_id":null,"reasoning":{"effort":null,"summary":null},"service_tier":"default","store":true,"temperature":1,"text":{"format":{"type":"text"}},"tool_choice":"auto","tools":[],"top_p":1,"truncation":"disabled","usage":{"input_tokens":634,"input_tokens_details":{"cached_tokens":0},"output_tokens":225,"output_tokens_details":{"reasoning_tokens":0},"total_tokens":859},"user":null,"metadata":{},"output_text":"~#BEGIN#~\\nOur new employee onboarding process starts the first Monday of every month, beginning with a mandatory virtual orientation session from 9 AM to 12 PM AEST. New hires will receive an email with their login credentials for the HR portal and our internal collaboration tool, Slack, 48 hours prior to their start date. It's crucial that they complete their tax forms and set up direct deposit in the HR portal within the first three days. After orientation, each new hire will be introduced to their team lead, who will guide them through specific departmental training and project assignments. We also offer a mentorship program where new employees are paired with experienced colleagues for the first six months to help them settle in and understand our company culture. Benefits enrollment, including health insurance and 401(k), must be completed by the end of their first week. For IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555. They will be provisioned with a laptop and necessary software by the end of their first day, provided they have completed the pre-onboarding IT survey.\\n~#END#~"}`);
const ES_API_RESPONSE_2 = undefined; // JSON.parse(`{"id":"resp_68495fde5de881a3b2f22b94c24e9bef0e5d5988ad7f3668","object":"response","created_at":1749639134,"status":"completed","background":false,"error":null,"incomplete_details":null,"instructions":null,"max_output_tokens":null,"model":"gpt-4o-mini-2024-07-18","output":[{"id":"msg_68495fdecdd081a393111880c573ed730e5d5988ad7f3668","type":"message","status":"completed","content":[{"type":"output_text","annotations":[],"text":"{\\n  \\"sections\\": [\\n    { \\n      \\"title\\": \\"Onboarding Process\\", \\n      \\"subtitle\\": \\"An overview of the entire onboarding journey for new employees.\\", \\n      \\"excerpt\\": \\"Our new employee onboarding process starts the first Monday of every month, beginning with a mandatory virtual orientation session from 9 AM to 12 PM AEST.\\" \\n    },\\n    { \\n      \\"title\\": \\"Orientation and Training\\", \\n      \\"subtitle\\": \\"Essential first steps after joining to ensure smooth integration.\\", \\n      \\"excerpt\\": \\"After orientation, each new hire will be introduced to their team lead, who will guide them through specific departmental training and project assignments.\\" \\n    },\\n    { \\n      \\"title\\": \\"IT Setup\\", \\n      \\"subtitle\\": \\"Everything new hires need to know about equipment and support.\\", \\n      \\"excerpt\\": \\"They will be provisioned with a laptop and necessary software by the end of their first day, provided they have completed the pre-onboarding IT survey.\\" \\n    },\\n    { \\n      \\"title\\": \\"Benefits Enrollment\\", \\n      \\"subtitle\\": \\"Crucial deadlines for important benefits participation.\\", \\n      \\"excerpt\\": \\"Benefits enrollment, including health insurance and 401(k), must be completed by the end of their first week.\\" \\n    },\\n    { \\n      \\"title\\": \\"Mentorship Program\\", \\n      \\"subtitle\\": \\"Supportive pairing to enhance the onboarding experience.\\", \\n      \\"excerpt\\": \\"We also offer a mentorship program where new employees are paired with experienced colleagues for the first six months to help them settle in and understand our company culture.\\" \\n    },\\n    { \\n      \\"title\\": \\"Initial Tasks and Deadlines\\", \\n      \\"subtitle\\": \\"Key action items for new hires within their first days.\\", \\n      \\"excerpt\\": \\"It's crucial that they complete their tax forms and set up direct deposit in the HR portal within the first three days.\\" \\n    },\\n    { \\n      \\"title\\": \\"Contact Information for IT Support\\", \\n      \\"subtitle\\": \\"Important contact details for help with technical issues.\\", \\n      \\"excerpt\\": \\"For IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555.\\" \\n    }\\n  ]\\n}","parsed":{"sections":[{"title":"Onboarding Process","subtitle":"An overview of the entire onboarding journey for new employees.","excerpt":"Our new employee onboarding process starts the first Monday of every month, beginning with a mandatory virtual orientation session from 9 AM to 12 PM AEST."},{"title":"Orientation and Training","subtitle":"Essential first steps after joining to ensure smooth integration.","excerpt":"After orientation, each new hire will be introduced to their team lead, who will guide them through specific departmental training and project assignments."},{"title":"IT Setup","subtitle":"Everything new hires need to know about equipment and support.","excerpt":"They will be provisioned with a laptop and necessary software by the end of their first day, provided they have completed the pre-onboarding IT survey."},{"title":"Benefits Enrollment","subtitle":"Crucial deadlines for important benefits participation.","excerpt":"Benefits enrollment, including health insurance and 401(k), must be completed by the end of their first week."},{"title":"Mentorship Program","subtitle":"Supportive pairing to enhance the onboarding experience.","excerpt":"We also offer a mentorship program where new employees are paired with experienced colleagues for the first six months to help them settle in and understand our company culture."},{"title":"Initial Tasks and Deadlines","subtitle":"Key action items for new hires within their first days.","excerpt":"It's crucial that they complete their tax forms and set up direct deposit in the HR portal within the first three days."},{"title":"Contact Information for IT Support","subtitle":"Important contact details for help with technical issues.","excerpt":"For IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555."}]}}],"role":"assistant"}],"parallel_tool_calls":true,"previous_response_id":null,"reasoning":{"effort":null,"summary":null},"service_tier":"default","store":true,"temperature":1,"text":{"format":{"type":"json_schema","description":null,"name":"result","schema":{"type":"object","properties":{"sections":{"type":"array","items":{"type":"object","properties":{"title":{"type":"string"},"subtitle":{"type":"string"},"excerpt":{"type":"string"}},"required":["title","subtitle","excerpt"],"additionalProperties":false}}},"required":["sections"],"additionalProperties":false},"strict":true}},"tool_choice":"auto","tools":[],"top_p":1,"truncation":"disabled","usage":{"input_tokens":598,"input_tokens_details":{"cached_tokens":0},"output_tokens":454,"output_tokens_details":{"reasoning_tokens":0},"total_tokens":1052},"user":null,"metadata":{},"output_text":"{\\n  \\"sections\\": [\\n    { \\n      \\"title\\": \\"Onboarding Process\\", \\n      \\"subtitle\\": \\"An overview of the entire onboarding journey for new employees.\\", \\n      \\"excerpt\\": \\"Our new employee onboarding process starts the first Monday of every month, beginning with a mandatory virtual orientation session from 9 AM to 12 PM AEST.\\" \\n    },\\n    { \\n      \\"title\\": \\"Orientation and Training\\", \\n      \\"subtitle\\": \\"Essential first steps after joining to ensure smooth integration.\\", \\n      \\"excerpt\\": \\"After orientation, each new hire will be introduced to their team lead, who will guide them through specific departmental training and project assignments.\\" \\n    },\\n    { \\n      \\"title\\": \\"IT Setup\\", \\n      \\"subtitle\\": \\"Everything new hires need to know about equipment and support.\\", \\n      \\"excerpt\\": \\"They will be provisioned with a laptop and necessary software by the end of their first day, provided they have completed the pre-onboarding IT survey.\\" \\n    },\\n    { \\n      \\"title\\": \\"Benefits Enrollment\\", \\n      \\"subtitle\\": \\"Crucial deadlines for important benefits participation.\\", \\n      \\"excerpt\\": \\"Benefits enrollment, including health insurance and 401(k), must be completed by the end of their first week.\\" \\n    },\\n    { \\n      \\"title\\": \\"Mentorship Program\\", \\n      \\"subtitle\\": \\"Supportive pairing to enhance the onboarding experience.\\", \\n      \\"excerpt\\": \\"We also offer a mentorship program where new employees are paired with experienced colleagues for the first six months to help them settle in and understand our company culture.\\" \\n    },\\n    { \\n      \\"title\\": \\"Initial Tasks and Deadlines\\", \\n      \\"subtitle\\": \\"Key action items for new hires within their first days.\\", \\n      \\"excerpt\\": \\"It's crucial that they complete their tax forms and set up direct deposit in the HR portal within the first three days.\\" \\n    },\\n    { \\n      \\"title\\": \\"Contact Information for IT Support\\", \\n      \\"subtitle\\": \\"Important contact details for help with technical issues.\\", \\n      \\"excerpt\\": \\"For IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555.\\" \\n    }\\n  ]\\n}","output_parsed":{"sections":[{"title":"Onboarding Process","subtitle":"An overview of the entire onboarding journey for new employees.","excerpt":"Our new employee onboarding process starts the first Monday of every month, beginning with a mandatory virtual orientation session from 9 AM to 12 PM AEST."},{"title":"Orientation and Training","subtitle":"Essential first steps after joining to ensure smooth integration.","excerpt":"After orientation, each new hire will be introduced to their team lead, who will guide them through specific departmental training and project assignments."},{"title":"IT Setup","subtitle":"Everything new hires need to know about equipment and support.","excerpt":"They will be provisioned with a laptop and necessary software by the end of their first day, provided they have completed the pre-onboarding IT survey."},{"title":"Benefits Enrollment","subtitle":"Crucial deadlines for important benefits participation.","excerpt":"Benefits enrollment, including health insurance and 401(k), must be completed by the end of their first week."},{"title":"Mentorship Program","subtitle":"Supportive pairing to enhance the onboarding experience.","excerpt":"We also offer a mentorship program where new employees are paired with experienced colleagues for the first six months to help them settle in and understand our company culture."},{"title":"Initial Tasks and Deadlines","subtitle":"Key action items for new hires within their first days.","excerpt":"It's crucial that they complete their tax forms and set up direct deposit in the HR portal within the first three days."},{"title":"Contact Information for IT Support","subtitle":"Important contact details for help with technical issues.","excerpt":"For IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555."}]}}`);

export async function extractStructure(input: string): Promise<ExtractedStructure> {
	return await _extractStructure(await getOpenAIClient(), input, [ES_API_RESPONSE_1, ES_API_RESPONSE_2]);
}

/////////////////////////////////////////////////

const FI_API_RESPONSE_1 = undefined; // JSON.parse(`{"id":"resp_684ab8179c188192bdda2ee55bbe8fa20331eb8910407535","object":"response","created_at":1749727255,"status":"completed","background":false,"error":null,"incomplete_details":null,"instructions":null,"max_output_tokens":null,"model":"gpt-4o-mini-2024-07-18","output":[{"id":"msg_684ab81822508192b81f81471955b77e0331eb8910407535","type":"message","status":"completed","content":[{"type":"output_text","annotations":[],"text":"~#BEGIN#~\\nFor IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555.\\n~#END#~"}],"role":"assistant"}],"parallel_tool_calls":true,"previous_response_id":null,"reasoning":{"effort":null,"summary":null},"service_tier":"default","store":true,"temperature":1,"text":{"format":{"type":"text"}},"tool_choice":"auto","tools":[],"top_p":1,"truncation":"disabled","usage":{"input_tokens":469,"input_tokens_details":{"cached_tokens":0},"output_tokens":32,"output_tokens_details":{"reasoning_tokens":0},"total_tokens":501},"user":null,"metadata":{},"output_text":"~#BEGIN#~\\nFor IT support, new employees should contact helpdesk@ourcompany.com or call extension 5555.\\n~#END#~"}`);
const FI_API_RESPONSE_2 = undefined; // JSON.parse(`{"id":"resp_684ab8191fd8819cb3e7b65c369f8167028236da0e270563","object":"response","created_at":1749727257,"status":"completed","background":false,"error":null,"incomplete_details":null,"instructions":null,"max_output_tokens":null,"model":"gpt-4o-mini-2024-07-18","output":[{"id":"msg_684ab81a0f14819c909c48c965a337aa028236da0e270563","type":"message","status":"completed","content":[{"type":"output_text","annotations":[],"text":"# IT Support for New Employees\\n\\nWelcome to the team! If you need assistance, please reach out to our IT support.\\n\\n## Contact Information\\n\\n- **Email:** [helpdesk@ourcompany.com](mailto:helpdesk@ourcompany.com)\\n- **Phone:** Extension 5555\\n\\nOur support team is here to help you. Don't hesitate to get in touch!"}],"role":"assistant"}],"parallel_tool_calls":true,"previous_response_id":null,"reasoning":{"effort":null,"summary":null},"service_tier":"default","store":true,"temperature":1,"text":{"format":{"type":"text"}},"tool_choice":"auto","tools":[],"top_p":1,"truncation":"disabled","usage":{"input_tokens":222,"input_tokens_details":{"cached_tokens":0},"output_tokens":76,"output_tokens_details":{"reasoning_tokens":0},"total_tokens":298},"user":null,"metadata":{},"output_text":"# IT Support for New Employees\\n\\nWelcome to the team! If you need assistance, please reach out to our IT support.\\n\\n## Contact Information\\n\\n- **Email:** [helpdesk@ourcompany.com](mailto:helpdesk@ourcompany.com)\\n- **Phone:** Extension 5555\\n\\nOur support team is here to help you. Don't hesitate to get in touch!"}`)

export async function improveSection(input: FilterAndImproveSectionInput): Promise<ImprovedKnowledgeBaseSection> {
	return await _filterAndImproveSection(await getOpenAIClient(), input, [FI_API_RESPONSE_1, FI_API_RESPONSE_2]);
}
